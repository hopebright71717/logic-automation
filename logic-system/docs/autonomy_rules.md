# Logic 自動化規則 — 工作自主性與確認機制

## 📋 目的
定義哪些任務可以自動完成，哪些需要使用者確認，以實現「低風險任務連續自動完成，高風險任務才停下來問」的目標。

---

## ✅ 可自動執行任務（不需確認）

以下任務被視為**低風險**，系統可以直接執行並回報結果：

### 1. 檔案與資料操作
- 建立新的 Markdown、JSON、YAML、CSV、TXT 檔案
- 更新現有的日誌、紀錄檔案（append 模式）
- 建立新資料夾
- 整理、歸檔檔案（不涉及刪除）
- 複製檔案到備份目錄
- 讀取、分析檔案內容

### 2. 資料分析與報告
- 生成統計報告
- 彙總成本資料
- 產生排行榜
- 分析日誌檔案
- 生成圖表或視覺化資料

### 3. 狀態與監控
- 更新 status.json
- 記錄任務進度
- 寫入錯誤/警告日誌
- 更新儀表板資料
- 記錄 API 使用量

### 4. 開發與測試（無副作用）
- 執行 lint、格式化程式碼
- 執行測試（不改動資料）
- 檢查語法
- 產生文件

### 5. 成本估算（預估 < 0.5 USD）
- 簡單的程式碼分析
- 小量文字摘要
- 單一檔案處理

---

## ⚠️ 需要確認任務（必須詢問使用者）

以下任務被視為**高風險**或**有重大影響**，必須先獲得使用者確認：

### 1. 系統管理操作
- 需要 `sudo` 權限的指令
- 安裝系統套件（apt、brew、yum 等）
- 修改系統設定
- 修改 PATH、環境變數

### 2. 財務相關
- 任何涉及付款、訂閱的操作
- 開啟 auto-recharge
- 新增信用卡資訊
- **預估單次 API 成本 > 1.0 USD**
- **單日累積成本 > 2.0 USD**（觸發降級策略）
- **本月累積成本 > 60 USD**（接近上限）

### 3. 資料刪除或不可逆操作
- 刪除檔案或資料夾
- 覆蓋重要檔案（非日誌類）
- 清空資料庫
- 批次刪除（> 10 個項目）
- 修改 .git 歷史

### 4. 外部服務與 API
- 發送 email、通知
- 對外部 API 進行 POST/DELETE 請求
- 部署到生產環境
- 修改雲端服務設定

### 5. 大規模操作
- 批次修改 > 20 個檔案
- 處理 > 1000 筆資料
- 執行時間預估 > 5 分鐘的任務

---

## 💰 成本門檻與降級策略

### 累積成本門檻

| 門檻 | 條件 | 動作 |
|------|------|------|
| **日常運作** | < 2 USD/day | 正常運作，使用預設模型 |
| **日軟上限** | ≥ 2 USD/day | ⚠️ 降級策略 1：切換到便宜模型 |
| **日硬上限** | ≥ 3 USD/day | 🛑 停用非必要 API，僅保留本地操作 |
| **月軟上限** | ≥ 50 USD/month | ⚠️ 降級策略 2：限制每日額度 |
| **月硬上限** | ≥ 65 USD/month | 🛑 完全停用 API，僅本地/免費功能 |

### 降級策略

#### 策略 1：模型降級
- 從 `gpt-4` 降到 `gpt-3.5-turbo`
- 從 `gpt-4-turbo` 降到 `gpt-4o-mini`
- 縮短 prompt 長度
- 減少生成 tokens

#### 策略 2：功能限制
- 停用自動摘要
- 停用自動翻譯
- 僅處理必要請求
- 延遲非緊急任務

#### 策略 3：完全本地化
- 僅使用本地工具（grep、sed、awk）
- 停用所有 LLM API
- 僅保留紀錄功能

---

## 📊 回覆格式規範

Bot 回覆時必須使用以下固定格式：

```
[STATE] 狀態摘要（一句話）
[OUTPUT] 本次產出：檔案路徑或連結
[COST] 本次成本：$X.XX USD / $XX TWD | 今日累積：$X.XX USD
[NEXT] 下一步：將執行 XXX（僅在需要確認時才詢問）
```

### 範例

**自動執行任務（不詢問）：**
```
[STATE] 正在更新今日工作紀錄
[OUTPUT] /logic/daily_log.md
[COST] 本次：$0.002 USD / $0.06 TWD | 今日：$0.15 USD
[NEXT] 將生成成本排行報告
```

**需確認任務（詢問）：**
```
[STATE] 準備刪除舊備份檔案
[OUTPUT] 無
[COST] 本次：$0 USD | 今日：$0.15 USD
[NEXT] ⚠️ 將刪除 50 個備份檔案，是否確認？
```

---

## 🔄 自動決策流程圖

```
新任務
  ↓
是否在「可自動執行清單」？
  ├─ 是 → 預估成本 < 0.5 USD？
  │         ├─ 是 → ✅ 直接執行
  │         └─ 否 → ⚠️ 詢問確認
  └─ 否 → 是否在「需要確認清單」？
            ├─ 是 → ⚠️ 詢問確認
            └─ 否 → 預設保守 → ⚠️ 詢問確認
```

---

## 📝 補充說明

1. **當有疑慮時，預設詢問**：若無法明確判斷風險等級，優先詢問使用者
2. **成本優先**：即使是可自動執行任務，若預估成本過高也要確認
3. **批次操作謹慎**：大規模批次操作（> 20 項）建議確認
4. **錯誤處理**：遇到錯誤時自動記錄並嘗試修復，若無法修復則詢問
5. **透明化**：每次執行後都要記錄到 daily_log.md 和 status.json

---

*最後更新：2026-02-01*
